{% extends "base.html" %}
{% load i18n static %}

{% block extrahead %}
    <link type="text/css" rel="stylesheet"
         href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet"
         href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css" />
    <link type="text/css" rel="stylesheet" href="{% static "booth/style.css" %}" />
    <link type="text/css" rel="stylesheet" href="{% static "visualizer/style.css" %}" />
{% endblock %}

<meta name="viewport" content="width=device-width, initial-scale=1">

{% block content %}
    <div id="app-visualizer">
        <!-- Navbar -->
        <b-navbar type="dark" data-html2canvas-ignore="true" variant="secondary">
            <b-navbar-brand tag="h1">Decide</b-navbar-brand>
            <ul class="nav">
                <script type="text/javascript"> 
                    function cambiarModo() { 
                        var cuerpoweb = document.body; 
                        cuerpoweb.classList.toggle("oscuro"); 
                    } 
                </script>
                <li><a href=""> ▼ Mostrar</a>
                    <ul>
                        <li>
                            <s>Resultados &nbsp
                                <label class="switch">
                                    <input id="checkbox_resultados" type="checkbox" onchange="mostrarResultados();" checked>
                                    <span class="slider round"></span>
                                </label>
                            </s>
                        </li>
                        <li>
                            <s>Estad&iacutesticas &nbsp
                                <label class="switch">
                                    <input id="checkbox_estadisticas" type="checkbox" onclick="mostrarContenido('statistics');" checked>
                                    <span class="slider round"></span>
                                </label>
                            </s>
                        </li>
                        <li>
                            <s>Gr&aacuteficas &nbsp
                                <label class="switch">
                                    <input id="checkbox_graficas" type="checkbox" onchange="mostrarGraficas();" checked>
                                    <span class="slider round"></span>
                                </label>
                            </s>
                        </li>
                    </ul>
                </li>
                <li><a href=""> ▼ Compartir</a>
                    <ul>
                        <li><a href="{{whatsappUrl}}">Whatsapp</a></li>
                        <li><a href="{{twitterUrl}}">Twitter</a></li>
                        <li><a href="{{facebookUrl}}">Facebook</a></li>
                    </ul>
                </li>
                <li><a href=""> ▼ Exportar</a>
                    <ul>
                        <li><a class="text-white" onclick="exportarPDF();">PDF</a></li>
                        <li><a class="text-white" onclick="exportarExcel('resultados_estadisticas')">Excel</a></li>
                    </ul>
                <li>
                <li><a href=""> ▼ Telegram</a>
                    <ul>
                        <li><a href={{botUrl}} target="_blank">Enviar resultados por Telegram </a></li>
                        <li><a href="https://t.me/guadalfeo_visualizacion" target="_blank">Unirse al canal de Telegram </a></li>
                    </ul>
                <li>
                    <p>Tema oscuro/claro &nbsp
                        <label class="switch">
                            <input id="checkbox_nocturno" type="checkbox" onclick="cambiarModo()" checked>
                            <span class="slider round"></span>
                        </label>
                    </p>
                </li>
            </ul>
        </b-navbar>

        <div class="voting mr-5">
            <h1>[[ voting.titulo ]]</h1>
            <h2 v-if="!voting.fecha_inicio">Votación no comenzada</h2>
            <h2 v-else-if="!voting.fecha_fin">Votación en curso</h2>
            <div v-else>
                <div id="resultados_estadisticas">
                    <div id="results">
                        <div id="enun_result"> 
                            <h2 class="heading">Resultados:</h2>
                        </div> 
                        <br>
                        <div id="enun_titulo0">                        
                            <h3 class="heading">[[voting.preguntas[0].titulo]]</h3>
                        </div>
                        <div>
                            <div id="resultados0">
                                <table class="table table-bordered table-condensed table-striped table-hover display-15 w-auto">
                                    <thead>
                                        <tr>
                                            <th><font size=2>Candidato</font></th>
                                            <th><font size=2>Votos totales</font></th>
                                            <th><font size=2>Votos masculinos</font></th>
                                            <th><font size=2>Votos femeninos</font></th>
                                            <th><font size=2>Votos de alumnos de primero</font></th>
                                            <th><font size=2>Votos de alumnos de segundo</font></th>
                                            <th><font size=2>Votos de alumnos de tercero</font></th>
                                            <th><font size=2>Votos de alumnos de cuarto</font></th>
                                            <th><font size=2>Votos de alumnos de master</font></th>
                                            <th><font size=2>Media de edad de sus votantes</font></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="opt in voting.preguntas[0].opts" :key="opt.numero">
                                            <td>[[opt.nombre]]</td>
                                            <td>[[opt.votes]]</td>
                                            <td>[[opt.voto_M]]</td>
                                            <td>[[opt.voto_F]]</td>
                                            <td>[[opt.voto_curso.primero]]</td>
                                            <td>[[opt.voto_curso.segundo]]</td>
                                            <td>[[opt.voto_curso.tercero]]</td>
                                            <td>[[opt.voto_curso.cuarto]]</td>
                                            <td>[[opt.voto_curso.master]]</td>
                                            <td>[[opt.media_edad]]</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div id="espacio_graficas0">
                                <div class="float-left abajito">
                                    <h6 style="text-align: center;">Votos de todos los candidatos</h6>
                                    <canvas id="myChartVotes0" width="50" height="30"></canvas>
                                </div>
                                <div class="float-right abajito">
                                    <h6 style="text-align: center;">Media de edad de los votantes</h6>
                                    <canvas id="myChartAges0" width="50" height="30"></canvas>
                                </div>
                                <div class="row menuito">
                                    <div class="col">
                                        <h6 id="tituloGraficosSexo0" style="text-align: center;">Votos por sexo de cada candidato</h6>
                                        <div id="graficosSexo0"></div>
                                    </div>
                                    <div class="col">
                                        <h6 id="tituloGraficosCurso0" style="text-align: center;">Votos por curso de cada candidato</h6>
                                        <div id="graficosCurso0"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div v-for="preg in [1,2,3,4,5]">
                            <br>
                            <div v-bind:id="'enun_titulo'+preg">
                                <h3 class="heading">[[voting.preguntas[preg].titulo]]</h3>
                            </div>
                            <div>
                                <div v-bind:id="'resultados'+preg">
                                    <table class="table table-bordered table-condensed table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>Candidato</th>
                                                <th>Votos totales</th>
                                                <th>Votos masculinos</th>
                                                <th>Votos femeninos</th>
                                                <th>Media de edad de sus votantes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="opt in voting.preguntas[preg].opts" :key="opt.numero">
                                                <td>[[opt.nombre]]</td>
                                                <td>[[opt.votes]]</td>
                                                <td>[[opt.voto_M]]</td>
                                                <td>[[opt.voto_F]]</td>
                                                <td>[[opt.media_edad]]</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div v-bind:id="'espacio_graficas'+preg">
                                    <div class="float-left abajito">
                                        <h6 style="text-align: center;">Votos de todos los candidatos</h6>
                                        <canvas v-bind:id="'myChartVotes'+preg" width="75" height="35"></canvas>
                                    </div> 
                                    <div class="float-right abajito">
                                        <h6 style="text-align: center;">Media de edad de los votantes</h6>
                                        <canvas v-bind:id="'myChartAges'+preg" width="75" height="35"></canvas>
                                    </div>
                                    <div class="row menuito">
                                        <div class="col-md-6">
                                            <h6 v-bind:id="'tituloGraficosCurso'+preg" style="text-align: center;">Votos por sexo de cada candidato</h6>
                                            <div v-bind:id="'graficosSexo'+preg"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div v-if="voting.tipo=='VG'">
                            <br>
                            <div id="enun_titulo6">
                                <h3 class="heading">[[voting.preguntas[6].titulo]]</h3>
                            </div>
                            <div>
                                <div id="resultados6">
                                    <table class="table table-bordered table-condensed table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th><font size=2>Candidato</font></th>
                                                <th><font size=2>Votos totales</font></th>
                                                <th><font size=2>Votos masculinos</font></th>
                                                <th><font size=2>Votos femeninos</font></th>
                                                <th><font size=2>Votos de alumnos de primero</font></th>
                                                <th><font size=2>Votos de alumnos de segundo</font></th>
                                                <th><font size=2>Votos de alumnos de tercero</font></th>
                                                <th><font size=2>Votos de alumnos de cuarto</font></th>
                                                <th><font size=2>Votos de alumnos de master</font></th>
                                                <th><font size=2>Media de edad de sus votantes</font></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="opt in voting.preguntas[6].opts" :key="opt.numero">
                                                <td>[[opt.nombre]]</td>
                                                <td>[[opt.votes]]</td>
                                                <td>[[opt.voto_M]]</td>
                                                <td>[[opt.voto_F]]</td>
                                                <td>[[opt.voto_curso.primero]]</td>
                                                <td>[[opt.voto_curso.segundo]]</td>
                                                <td>[[opt.voto_curso.tercero]]</td>
                                                <td>[[opt.voto_curso.cuarto]]</td>
                                                <td>[[opt.voto_curso.master]]</td>
                                                <td>[[opt.media_edad]]</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div id="espacio_graficas6">
                                    <div class="float-left abajito">
                                        <h6 style="text-align: center;">Votos de todos los candidatos</h6>
                                        <canvas id="myChartVotes6" width="50" height="30"></canvas>
                                    </div>
                                    <div class="float-right abajito">
                                        <h6 style="text-align: center;">Media de edad de los votantes</h6>
                                        <canvas id="myChartAges6" width="50" height="30"></canvas>
                                    </div>
                                    <div class="row menuito">
                                        <div class="col">
                                            <h6 id="tituloGraficosSexo6" style="text-align: center;">Votos por sexo de cada candidato</h6>
                                            <div id="graficosSexo6"></div>
                                        </div>
                                        <div class="col">
                                            <h6 id="tituloGraficosCurso6" style="text-align: center;">Votos por curso de cada candidato</h6>
                                            <div id="graficosCurso6"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="statistics"><br>
                        <h2 class="heading">Estadísticas:</h2><br>
                        
                        <table class="table table-bordered table-condensed table-striped table-hover">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>Totales</th>
                                    <th>Primero</th>
                                    <th>Segundo</th>
                                    <th>Tercero</th>
                                    <th>Cuarto</th>
                                    <th>Master</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th>Porcentaje de abstención</th>
                                    <td>[[ voting.estadisticas.abstencion._0 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion._1 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion._2 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion._3 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion._4 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion._5 ]] %</td>
                                </tr>
                                <tr>
                                    <th>Porcentaje de abstención masculina</th>
                                    <td>[[ voting.estadisticas.abstencion_m._0 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion_m._1 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion_m._2 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion_m._3 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion_m._4 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion_m._5 ]] %</td>
                                </tr>
                                <tr>
                                    <th>Porcentaje de abstención femenina</th>
                                    <td>[[ voting.estadisticas.abstencion_f._0 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion_f._1 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion_f._2 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion_f._3 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion_f._4 ]] %</td>
                                    <td>[[ voting.estadisticas.abstencion_f._5 ]] %</td>
                                </tr>
                                <tr>
                                    <th>Media de edad</th>
                                    <td>[[ voting.estadisticas.media_edad._0 ]] %</td>
                                    <td>[[ voting.estadisticas.media_edad._1 ]] %</td>
                                    <td>[[ voting.estadisticas.media_edad._2 ]] %</td>
                                    <td>[[ voting.estadisticas.media_edad._3 ]] %</td>
                                    <td>[[ voting.estadisticas.media_edad._4 ]] %</td>
                                    <td>[[ voting.estadisticas.media_edad._5 ]] %</td>
                                </tr>

                            </tbody>
                        </table><br>

                        <h3 class="heading">[[voting.preguntas[0].titulo]]</h3>
                        <table class="table table-bordered table-condensed table-striped table-hover">
                            <thead>
                                <tr>
                                    <th><font size=2>Candidato</font></th>
                                    <th><font size=2>Porcentaje de votos respecto al censo</font></th>
                                    <th><font size=2>Porcentaje de votantes masculinos</font></th>
                                    <th><font size=2>Porcentaje de votantes femeninos</font></th>
                                    <th><font size=2>Porcentaje de votantes primer curso</font></th>
                                    <th><font size=2>Porcentaje de votantes segundo curso</font></th>
                                    <th><font size=2>Porcentaje de votantes tercer curso</font></th>
                                    <th><font size=2>Porcentaje de votantes cuarto curso</font></th>
                                    <th><font size=2>Porcentaje de votantes master</font></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="opt in voting.preguntas[0].opts" :key="opt.numero">
                                    <td>[[opt.nombre]]</td>
                                    <td>[[opt.estadisticas.votos_censo]] %</td>
                                    <td>[[opt.estadisticas.votos_m]] %</td>
                                    <td>[[opt.estadisticas.votos_f]] %</td>
                                    <td>[[opt.estadisticas.votos_primero]] %</td>
                                    <td>[[opt.estadisticas.votos_segundo]] %</td>
                                    <td>[[opt.estadisticas.votos_tercero]] %</td>
                                    <td>[[opt.estadisticas.votos_cuarto]] %</td>
                                    <td>[[opt.estadisticas.votos_master]] %</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div v-for="preg in [1,2,3,4,5]">
                            <br>
                            <h3 class="heading">[[voting.preguntas[preg].titulo]]</h3>
                            <table class="table table-bordered table-condensed table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Candidato</th>
                                        <th>Porcentaje de votos respecto al censo del curso</th>
                                        <th>Porcentaje de votantes masculinos</th>
                                        <th>Porcentaje de votantes femeninos</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="opt in voting.preguntas[preg].opts" :key="opt.numero">
                                        <td>[[opt.nombre]]</td>
                                        <td>[[opt.estadisticas.votos_censo]] %</td>
                                        <td>[[opt.estadisticas.votos_m]] %</td>
                                        <td>[[opt.estadisticas.votos_f]] %</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div v-if="voting.tipo=='VG'">
                            <br>
                            <h3 class="heading">[[voting.preguntas[6].titulo]]</h3>
                            <table class="table table-bordered table-condensed table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th><font size=2>Candidato</font></th>
                                        <th><font size=2>Porcentaje de votos respecto al censo</font></th>
                                        <th><font size=2>Porcentaje de votantes masculinos</font></th>
                                        <th><font size=2>Porcentaje de votantes femeninos</font></th>
                                        <th><font size=2>Porcentaje de votantes primer curso</font></th>
                                        <th><font size=2>Porcentaje de votantes segundo curso</font></th>
                                        <th><font size=2>Porcentaje de votantes tercer curso</font></th>
                                        <th><font size=2>Porcentaje de votantes cuarto curso</font></th>
                                        <th><font size=2>Porcentaje de votantes master</font></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="opt in voting.preguntas[6].opts" :key="opt.numero">
                                        <td>[[opt.nombre]]</td>
                                        <td>[[opt.estadisticas.votos_censo]] %</td>
                                        <td>[[opt.estadisticas.votos_m]] %</td>
                                        <td>[[opt.estadisticas.votos_f]] %</td>
                                        <td>[[opt.estadisticas.votos_primero]] %</td>
                                        <td>[[opt.estadisticas.votos_segundo]] %</td>
                                        <td>[[opt.estadisticas.votos_tercero]] %</td>
                                        <td>[[opt.estadisticas.votos_cuarto]] %</td>
                                        <td>[[opt.estadisticas.votos_master]] %</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Footer -->
        <b-footer data-html2canvas-ignore="true" variant="secondary">
            <ul class="foot">
                <li>
                    <a class="AboutUs" href='/visualizer/aboutUs/'>About Us</a>
                    <a class="ContactUs" href='/visualizer/contactUs/'>Contact Us</a>
                </li>
            </ul>
        </b-footer>
    </div>
{% endblock %}

{% block extrabody %}
    <!-- Vuejs -->
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://raw.githack.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>

    <script>
        var voting = {{voting|safe}};
        var app = new Vue({
            delimiters: ['[[', ']]'],
            el: '#app-visualizer',
            data: {
                voting: voting
            }
        })
    </script>

    <script>

        /*
        function mostrarEnunciado() {
            var divResult = document.getElementById('resultados0');
            var divGraf = document.getElementById('espacio_graficas0');
            for (var i=0; i<7; i++) {
                var enunTit = document.getElementById('enun_titulo'+i);

                if(divResult.style.display === "none" && divGraf.style.display === "none") {
                    enunTit.style.display = "none";
                } else {
                    enunTit.style.display = "block";
                }
            }
        }
        */

        function mostrarEnunciado() {
            var divResult = document.getElementById('resultados0');
            var divGraf = document.getElementById('espacio_graficas0');

            var enunTit = document.getElementById('results');

            if(divResult.style.display === "none" && divGraf.style.display === "none") {
                enunTit.style.display = "none";
            } else {
                enunTit.style.display = "block";
            }
        }


        function mostrarResultados() {
            var limit = 7;
            if(voting.tipo === 'VP'){
                limit = 6;
            }
            mostrarContenido('enun_result');
            for (var i=0; i<limit; i++) {
                mostrarContenido('resultados'+i);
            }
            mostrarEnunciado();
        }
        function mostrarGraficas() {
            var limit = 7;
            if(voting.tipo === 'VP'){
                limit = 6;
            }
            for (var i=0; i<limit; i++) {
                mostrarContenido('espacio_graficas'+i);
            }
            mostrarEnunciado();
        }


        function mostrarContenido(id) {
            var graficas = document.getElementById(id);
                if (graficas.style.display === "none") {
                graficas.style.display = "block";
                } else {
                    graficas.style.display = "none";
                }
        }

        function graficoBarras(id, etiquetas, datos, etY, colores) {
            var ctx= document.getElementById(id).getContext("2d");
            var myChart= new Chart(ctx,{
                type:'bar',
                data: {
                    labels: etiquetas,
                    datasets: [{
                        label: etY,
                            data: datos, 
                            backgroundColor:  colores,
                            borderColor:  colores,
                            borderWidth: 1
                    }]
                    },
                options:{
                    responsive: true,
                    legend :{
                        display: false
                    },
                    scales:{
                        yAxes:[{
                            scaleLabel: {
                                display: true,
                                labelString: etY
                            },
                            ticks:{
                                beginAtZero:true
                            },
                            stacked: false
                        }]
                    }
                }
            });
        }

        function getRandomColor() {
            var trans = '0.5'; // 50% transparency
            var color = 'rgba(';
            for (var i = 0; i < 3; i++) {
                color += Math.floor(Math.random() * 255) + ',';
            }
            color += trans + ')'; // add the transparency
            return color;
        }

        var preguntas=voting.preguntas
        for (var i = 0; i < preguntas.length; i++) {
            var candidatos=preguntas[i].opts
            var nombres=[]
            var votos=[]
            var mediasEdad=[]
            var colores=[]
            var div="" 
            div = document.getElementById("graficosSexo"+i.toString());
            var divCurso="" 
            divCurso = document.getElementById("graficosCurso"+i.toString());
            var mostrarTituloS = false
            var mostrarTituloC = false
            for(var e=0; e<candidatos.length;e++){
                nombres.push(candidatos[e].nombre)
                votos.push(candidatos[e].votes)
                mediasEdad.push(candidatos[e].media_edad)
                colores.push(getRandomColor())

                //Crear grafos votos por candidatos segun sexo
                if(candidatos[e].votes !=0 ){
                    var canvas = document.createElement('canvas');
                    canvas.id     = "myPieCharm"+i.toString()+"-"+e.toString();
                    canvas.width  = 107;
                    canvas.height = 27;
                    div.appendChild(canvas)
                    mostrarTituloS = true
                    graficoSectoresSexo("myPieCharm"+i.toString()+"-"+e.toString(), [candidatos[e].voto_F, candidatos[e].voto_M], candidatos[e].nombre)
                }
                //Crear grafos voto por curso
                if(i==0 || i==6){
                    if(candidatos[e].votes !=0 ){
                        var canvasCurso = document.createElement('canvas');
                        canvasCurso.id = "myPieCharmCurso"+i.toString()+"-"+e.toString();
                        canvasCurso.width  = 107;
                        canvasCurso.height = 27;
                        divCurso.appendChild(canvasCurso)
                        mostrarTituloC = true

                        var votosCurso=[]
                        votosCurso.push(candidatos[e].voto_curso.primero)
                        votosCurso.push(candidatos[e].voto_curso.segundo)
                        votosCurso.push(candidatos[e].voto_curso.tercero)
                        votosCurso.push(candidatos[e].voto_curso.cuarto)
                        votosCurso.push(candidatos[e].voto_curso.master)
                        graficoSectoresCurso("myPieCharmCurso"+i.toString()+"-"+e.toString(), votosCurso, candidatos[e].nombre)
                    }
                }
                

            }
            if( (i==0 || i==6) && !mostrarTituloC ) {
                var para = document.createElement("p");
                var node = document.createTextNode("No existen datos");
                para.appendChild(node);
                para.style.textAlign="center";
                divCurso.appendChild(para);
            }
            if( !mostrarTituloS ) {
                var para = document.createElement("p");
                var node = document.createTextNode("No existen datos");
                para.appendChild(node);
                para.style.textAlign="center";
                div.appendChild(para);
            }
            
            graficoBarras("myChartVotes"+i.toString(), nombres, votos, "Votos",colores);
            graficoBarras("myChartAges"+i.toString(), nombres, mediasEdad, "Edad",colores);

        }

        function graficoSectoresSexo(id, datos, candidato) {
            var ctx= document.getElementById(id).getContext("2d");
            var myChart= new Chart(ctx,{
                type:'pie',
                data: {
                    labels: ['Hombres','Mujeres'],
                    datasets: [{
                            label: 'Votos',
                            data: datos, 
                            backgroundColor: [
                                'rgba(54, 162, 235, 0.2)',
                                'rgba(255, 99, 132, 0.2)'
                            ],
                            borderColor: [
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 99, 132, 1)'
                            ],
                            borderWidth: 1
                            }]
                    },
                options:{
                    responsive: true,
                    title :{
                        display: true,
                        text: candidato
                    },
                    legend :{
                        display: false
                    },
                    scales:{
                        yAxes:[{
                            ticks:{
                                beginAtZero:true
                            },
                            display: false,
                            stacked: false
                        }],
                        xAxes:[{
                            display: false
                        }]
                    }
                }
            });
        }

        function graficoSectoresCurso(id, datos, candidato) {
            var ctx= document.getElementById(id).getContext("2d");
            var myChart= new Chart(ctx,{
                type:'pie',
                data: {
                    labels: ['Votos Primero','Votos Segundo','Votos Tercero','Votos Cuarto', 'Votos Master'],
                    datasets: [{
                            label: 'Votos',
                            data: datos, 
                            backgroundColor: [
                                'rgba(54, 162, 235, 0.2)',
                                'rgba(255, 99, 132, 0.2)',
                                'rgba(142, 38, 163, 0.2)',
                                'rgba(56, 163, 38, 0.2)',
                                'rgba(224, 212, 45, 0.2)',
                            ],
                            borderColor: [
                                'rgba(54, 162, 235, 0.2)',
                                'rgba(255, 99, 132, 0.2)',
                                'rgba(142, 38, 163, 0.2)',
                                'rgba(56, 163, 38, 0.2)',
                                'rgba(224, 212, 45, 0.2)',
                            ],
                            borderWidth: 1
                            }]
                    },
                options:{
                    responsive: true,
                    title :{
                        display: true,
                        text: candidato
                    },
                    legend :{
                        display: false
                    },
                    scales:{
                        yAxes:[{
                            ticks:{
                                beginAtZero:true
                            },
                            display: false,
                            stacked: false
                        }],
                        xAxes:[{
                            display: false
                        }]
                    }
                }
            });
        }

        function exportarPDF(){       
            function mostrarResultados(id) {
                var graficas = document.getElementById(id);
                if (graficas.style.display === "none") {
                    graficas.style.display = "block";
                }
            }

            mostrarResultados("results")   
            mostrarResultados("espacio_graficas0") 
            mostrarResultados("espacio_graficas1") 
            mostrarResultados("espacio_graficas2") 
            mostrarResultados("espacio_graficas3") 
            mostrarResultados("espacio_graficas4")
            mostrarResultados("espacio_graficas5")

            var limit = 7;
            if(voting.tipo === 'VP'){
                limit = 6;
            } else mostrarResultados("espacio_graficas6");

            for(i=0;i<limit;i++) {
                var cssGrafVotes = document.getElementById("myChartVotes"+i);
                var cssGrafAges = document.getElementById("myChartAges"+i);
                cssGrafVotes.style.cssText = "width:100%";
                cssGrafAges.style.cssText = "width:100%";
            }

            var elementHTML= document.getElementById('app-visualizer');

            var opt = {
                filename:     'resultados.pdf',
                image:        { type: 'png', quality: 0.98 },
                html2canvas:  {dpi: 400, letterRendering: true, useCORS: true},
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'landscape' }
                };

            html2pdf().from(elementHTML).set(opt).save();

        }

    </script>

    <script>

        function exportarExcel(tableID, filename = ''){
            function removeElement(elementId) {
                // Removes an element from the document
                var element = document.getElementById(elementId);
                element.parentNode.removeChild(element);
            }
            var downloadLink;
            var dataType = 'data:application/vnd.ms-excel;charset=UTF-8';
            for (i=0; i<7; i++) {
                removeElement('espacio_graficas'+i)
            }
            var tableSelect = document.getElementById(tableID);
            var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');

            while (tableHTML.indexOf('á') != -1) tableHTML = tableHTML.replace('á', '&aacute;');
            while (tableHTML.indexOf('Á') != -1) tableHTML = tableHTML.replace('Á', '&Aacute;');
            while (tableHTML.indexOf('é') != -1) tableHTML = tableHTML.replace('é', '&eacute;');
            while (tableHTML.indexOf('É') != -1) tableHTML = tableHTML.replace('É', '&Eacute;');
            while (tableHTML.indexOf('í') != -1) tableHTML = tableHTML.replace('í', '&iacute;');
            while (tableHTML.indexOf('Í') != -1) tableHTML = tableHTML.replace('Í', '&Iacute;');
            while (tableHTML.indexOf('ó') != -1) tableHTML = tableHTML.replace('ó', '&oacute;');
            while (tableHTML.indexOf('Ó') != -1) tableHTML = tableHTML.replace('Ó', '&Oacute;');
            while (tableHTML.indexOf('ú') != -1) tableHTML = tableHTML.replace('ú', '&uacute;');
            while (tableHTML.indexOf('Ú') != -1) tableHTML = tableHTML.replace('Ú', '&Uacute;');
            while (tableHTML.indexOf('ñ') != -1) tableHTML = tableHTML.replace('ñ', '&ntilde;');
            while (tableHTML.indexOf('Ñ') != -1) tableHTML = tableHTML.replace('Ñ', '&Ntilde;');
            while (tableHTML.indexOf('º') != -1) tableHTML = tableHTML.replace('º', '&ordm;');
            
            filename = filename?filename+'.xls':'resultados_y_estadisticas.xls';
            downloadLink = document.createElement("a");
            document.body.appendChild(downloadLink);
            
            if(navigator.msSaveOrOpenBlob){
                var blob = new Blob(['ufeff', tableHTML], {
                    type: dataType
                });
                navigator.msSaveOrOpenBlob( blob, filename);
            }else{
                downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
                downloadLink.download = filename;
                downloadLink.click();
            }
        }

    </script>

</body>
{% endblock %}
